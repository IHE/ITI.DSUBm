This section corresponds to transaction ITI-113 Resource Subscription Search of the IHE Technical Framework. Transaction [ITI-113] Resource Subscription Search is used by the the Resource Notification Subscriber and Resource Notification Broker actors. The Resource Subscription Search [ITI-113] transaction is used to query Subscription or SubscriptionTopic and get back the results.

### Scope

The Resource Subscription Search [ITI-113] transaction passes a Resource Subscription Search or Resource SubscriptionTopic Search from a Resource Notification Subscriber to a Resource Notification Broker.

### Actors Roles

**Table: Actor Roles**

|Actor | Role |
|-------------------+--------------------------|
| [Resource Notification Subscriber](volume-1.html#subscriber)     | Sends the query request to the Resource Notification Broker |
| [Resource Notification Broker](volume-1.html#broker) | Receives the query and responds |

### Referenced Standards

**FHIR-R4B** [HL7 FHIR Release 4.3.0](http://www.hl7.org/FHIR/R4B)

### Interactions

<figure>
{%include ITI-113-Subscription-seq.svg%}
<figcaption><b>Figure 2:3.113: ITI-113 interactions</b></figcaption>
</figure>
<br clear="all">

#### Resource Notification Subscriber Request Message
The Resource Notification Subscriber Request Message is a parametrized HTTP GET that allows to search for a list of Subscription resources managed by the Resource Notification Broker, based on a set of search parameters.

##### Trigger Events

A Resource Notification Subscriber sends this message to the Resource Notification Broker when it needs to discover Subscription Resource or SubscriptionTopic resource.  

##### Message Semantics

The Resource Notification Subscriber sends a HTTP GET request to the Resource Notification Broker. This request shall comply with requirements specified in the HL7<sup>®</sup>
FHIR<sup>®</sup> standard <http://hl7.org/fhir/R4/http.html#search>.

The search target URL follows the FHIR HTTP specification <http://hl7.org/fhir/R4B/http.html>, addressing the resource type that the Resource Notification Subscriber is interested to discorver. 

The Resource Notification Subscriber Request Message can be expressed by addressing the Subscription Resource: 
>GET  \[base\]/Subscription?\[Parameters\]

The Resource Notification Subscriber may provide the optional parametr "_format" to specify the desiderd MIME-types in the response message. The Resource Notification Broker should accept "application/fhir+xml" and "application/fhir+json" as _format parameter.  For example, indicating application/fhir+json could result in the response from the Resource Notification Broker being a json FHIR Bundle with all the content encoded as FHIR resources.

TO DO QUERY PARAMETERS

##### Expected Actions

The Resource Notification Broker received the message shall process the request and respond with the results of the search.

#### Resource Notification Subscriber Response Message
The Resource Notification Broker returns a HTTP status code appropiate to the processing as well a Bundle containing a list of the matching Subscription resources.

##### Trigger Events

The Resource Notification Broker completed processing of the request message.

##### Message Semantics

Based on the query results, the Resource Notification Broker will either return an error or success. Guidance on handling Access Denied related to use of 200, 403 and 404 can be found in ITI TF-2x: [Appendix Z.7](https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.7-guidance-on-access-denied-results).

When the the Resource Notification Broker needs to report an error, it shall use HTTP error response codes and should include a FHIR OperationOutcome with more details on the failure. See FHIR http://hl7.org/fhir/R4/http.html and http://hl7.org/fhir/R4B/operationoutcome.html.

If the Resource Subscription Search message is processed successfully, whether or not any Subscription Resources are found, the HTTP status code shall be 200. The Resource Subscription Search Response message shall be a Bundle Resource containing zero or more Subscription Resources. If the Document Responder is sending warnings, the Bundle Resource shall also contain an OperationOutcome Resource that contains those warnings.

The response shall adhere to the FHIR Bundle constraints specified in ITI TF-2x: [Appendix Z.7](https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.1-resource-bundles)

##### Expected Actions
The Resource Notification Subscriber shall process the results according to application-defined rules.

### CapabilityStatement Resource

Server implementing this transaction shall provide a CapabilityStatement Resource as described in ITI TF-2x: Appendix Z.3 indicating the transaction has been implemented. 
* Requirements CapabilityStatement for [Client](CapabilityStatement-IHE.ToDo.client.html)
* Requirements CapabilityStatement for [Server](CapabilityStatement-IHE.ToDo.server.html)

### Security Considerations

See [MHD Security Considerations](volume-1.html#security-considerations)

#### Security Audit Considerations

''TODO: The security audit criteria ''

##### Client Audit 

''TODO: the specifics''

##### Server Audit 

''TODO: the specifics''
