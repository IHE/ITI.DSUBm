This section corresponds to the Resource Publish [ITI-111] transaction of the IHE Technical Framework. The Resource Publish [ITI-111] transaction is used by the Resource Notification Publisher and Resource Notification Broker Actors. This transaction is used to communicate events about DocumentReference, Folder type List and SubmissionSet type List Resources. 

### 2:3.111.1 Scope

The Resource Publish [ITI-111] transaction delivers information from the Resource Notification Publisher to the Resource Notification Broker about events regarding DocumentReference, Folder type List and SubmissionSet type List resources. This information can be evaluated by the Resource Notification Broker against active Subscriptions and which may trigger a notification.

### 2:3.111.2 Actors Roles

**Table 2:3.111.2-1: Actor Roles**

|Actor | Role |
|-------------------+--------------------------|
| [Resource Notification Publisher](volume-1.html#154113-resource-notification-publisher)    | Publishes information to the Resource Notification Broker when applicable events occur about DocumentReference, Folder type List and SubmissionSet type List resources for which a subscription may exist |
| [Resource Notification Broker](volume-1.html#154111-resource-notification-broker) | Receives and processes information about events for which there may be a subscription |
{: .grid}

### 2:3.111.3 Referenced Standards

**FHIR-R4B** [HL7 FHIR Release 4.3.0](https://www.hl7.org/FHIR/R4B)

### 2:3.111.4 Interactions

<figure>
{%include ITI-111-Publish-seq.svg%}
<figcaption><b>Figure 2:3.111.4-1: Resource Publish [ITI-111] interactions</b></figcaption>
</figure>
<br clear="all">

#### 2:3.111.5 Resource Publish Request Message
This method uses an HTTP POST method on the target Resource Notification Broker endpoint to communicate a event that may have a subscription.

##### 2:3.111.5.1 Trigger Events

When an event occurs for which a Subscription may exist, the Resource Notification Publisher will trigger a Resource Publish Request message to the Resource Notification Broker. 
Events that could trigger this message are:
- creation of a DocumentReference Resource; 
- creation or update of a Folder type List Resource; 
- creation of a SubmissionSet type List Resource.

Note that these events could be determined by DocumentEntry, Folder, Association, and SubmissionSet Objects events in an XDS environment.

###### 2:3.111.5.1.1 Updates to document sharing resources option trigger events

When the Resource Notification Publisher supports the [Updates to document sharing resources option](volume-1.html#15421-updates-to-document-sharing-resources-option), in addition to the previous events, events that could trigger this message also are:
- update or deletion of a DocumentReference Resource, 
- deletion of a Folder type List Resource.

Note that also these events could be determined by DocumentEntry, Folder, Association, and SubmissionSet Objects events in an XDS environment.

##### 2:3.111.5.2 Message Semantics

The Resource Notification Publisher shall initiate a FHIR "transaction" using a "create" action by sending an HTTP POST request method composed of a FHIR Bundle Resource containing: one `SubmissionSet type List Resource`;  zero or more `DocumentReference Resources`; zero or more `Folder type List Resources`. 

The Bundle resource shall contain all the FHIR resources related to the event that has occurred in the `Bundle.entry` element.

The media type of the HTTP body shall be either `application/fhir+json` or `application/fhir+xml`.

See [http://hl7.org/fhir/R4B/http.html#transaction](http://hl7.org/fhir/R4B/http.html#transaction) for complete requirements of a transaction. See [http://hl7.org/fhir/R4B/bundle-transaction.html](http://hl7.org/fhir/R4B/bundle-transaction.html) for example of a transaction Bundle.

The Provide Document Bundle message is sent to the base URL as defined in FHIR. See [http://hl7.org/fhir/R4B/http.html](http://hl7.org/fhir/R4B/http.html) for the definition of “HTTP” access methods and “base”.

It is possible to use HTTP protocol or HTTPS protocol. The HTTPS protocol is highly recommended.

For complete information on constructing a FHIR Bundle Resource, see [http://hl7.org/fhir/R4B/bundle.html](http://hl7.org/fhir/R4B/bundle.html).


The FHIR Bundle shall conform to the [Minimal Metadata Bundle](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.ProvideBundle.html) of Provide Document Bundle [ITI-65] transaction of [MHD](https://profiles.ihe.net/ITI/MHD/index.html) profile.


###### 2:3.111.5.2.1 Updates to document sharing resources option Bundle

When supported the [Updates to document sharing resources option](volume-1.html#15421-updates-to-document-sharing-resources-option) the FHIR Bundle that shall be used for transmitting the [Updates to document sharing resources option trigger events](#23111511-updates-to-document-sharing-resources-option-trigger-events) shall have the following constraints:

 - [Publishing Bundle](StructureDefinition-IHE.DSUBm.ResourceBundle.html):
    - shall be a Transaction Bundle
    - all resources shall be compliant with minimal constraints
    - shall convey at least one of:
        - [SubmissionSet type List](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.SubmissionSet.html)
        - [DocumentReference](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.DocumentReference.html)
        - [Folder type List](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.Folder.html)
    - may convey at most one [SubmissionSet type List](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.SubmissionSet.html)
    - may convey one or more [DocumentReference](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.DocumentReference.html)
    - may convey one or more [Folder type List](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.Folder.html)
    - may convey one [Patient](https://hl7.org/fhir/R4B/patient.html)
    - for each `entry` of SubmissionSet type List, DocumentReference and Folder type List, the `request.method` element shall be valued according with the event regarding the resource 

##### 2:3.111.5.3 Expected Actions

The Resource Notification Broker shall accept both media types application/fhir+json and application/fhir+xml.

The Resource Notification Broker shall process the bundle atomically as specified in [http://hl7.org/fhir/R4B/http.html#transaction](http://hl7.org/fhir/R4B/http.html#transaction).

The Resource Notification Broker shall validate the Bundle first against the FHIR specification. Guidance on what FHIR considers a valid Resource can be found at [http://hl7.org/fhir/R4B/validation.html](http://hl7.org/fhir/R4B/validation.html).

If necessary for processing, the Resource Notification Broker shall retrieve Resources referenced by absolute URLs in the FHIR Bundle Resource.

If the Resource Notification Broker validations failed, the Resource Notification Broker shall return an error, as documented in [Resource Publish Response Message](#Resource-Publish-Response-Message). 

If the validation of the Resource Publish Request Message is completed, the Resource Notification Broker shall evaluate the DocumentReference, the Folder type List and the SubmissionSet type List Resources that are present in the Bundle against the active Subscriptions. The Resource Notification Broker may not care about the other resources present in the Bundle. If there are matching subscriptions, the Resource Notification Broker shall send the [Event Notification Message [ITI-112]](ITI-112.html#231127-event-notification-message) to the appropriate Resource Notification Recipient.

<a name="Resource-Publish-Response-Message"> </a>

#### 2:3.111.6 Resource Publish Response Message

The Resource Notification Broker sends a Resource Publish Response Message to respond to a Resource Publish Request Message.

##### 2:3.111.6.1 Trigger Events

The Resource Notification Broker has received a Resource Publish Request Message.

##### 2:3.111.6.2 Message Semantics

The Resource Notification Broker shall return a Bundle, with `type` set to `transaction-response`, that contains one entry for each entry in the request, in the same order as received, with the Bundle.entry.response.outcome indicating the results of processing the entry. TheResource Notification Broker shall comply with FHIR [http://hl7.org/fhir/R4B/bundle.html#transaction-response](http://hl7.org/fhir/R4B/bundle.html#transaction-response) and [http://hl7.org/fhir/R4B/http.html#transaction-response](http://hl7.org/fhir/R4B/http.html#transaction-response).

To indicate success the overall http 200 response is used. The Bundle.entry.response.status shall be 201 and the .location element shall be populated if the Resource has been created or deleted. The Bundle.entry.response.status shall be 200 and the .location element shall be populated if the Resource has been updated.

##### 2:3.111.6.3 Expected Actions

The Resource Notification Publisher processes the results according to application-defined rules.

### 2:3.111.7 CapabilityStatement Resource
The Resource Notification Publisher implementing this transaction shall provide a CapabilityStatement Resource as described in [ITI TF-2x: Appendix Z.3](https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource) indicating the transaction has been implemented. 
- FHIR Capability Statement for [Resource Notification Publisher](CapabilityStatement-IHE.DSUBm.ResourceNotificationPublisher.html)
- FHIR Capability Statement for [Resource Notification Publisher](CapabilityStatement-IHE.DSUBm.ResourceNotificationPublisher.UpdateOption.html) that support the [Updates to document sharing resources](volume-1.html#15421-updates-to-document-sharing-resources-option) option.

The Resource Notification Broker implementing this transaction shall provide a CapabilityStatement Resource as described in [ITI TF-2x: Appendix Z.3](https://profiles.ihe.net/ITI/TF/Volume2/ch-Z.html#z.3-capabilitystatement-resource) indicating the transaction has been implemented. 
- FHIR Capability Statement for [Resource Notification Broker](CapabilityStatement-IHE.DSUBm.ResourceNotificationBroker.html)
- FHIR Capability Statement for [Resource Notification Broker](CapabilityStatement-IHE.DSUBm.ResourceNotificationBroker.UpdateOption.html) that support the [Updates to document sharing resources](volume-1.html#15421-updates-to-document-sharing-resources-option) option.


### 2:3.111.8 Security Considerations

See [DSUBm Security Considerations](volume-1.html#1545-security-considerations). 

It's highly recommended that the Resource Notification Publisher should use some form of authentication method when sending the Resource Publish Request Message. The Resource Notification Broker should always verify the authentication token used in this transaction before considering the message received.  

#### 2:3.111.8.1 Security Audit Considerations

The Resource Notification Publisher, when grouped with [ATNA](https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html) Secure Node or Secure Application Actor, shall be able to record fundamental AuditEvents for [BALP](https://profiles.ihe.net/ITI/BALP/index.html) [Create](https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Create.html), when performing this transaction.

The Resource Notification Broker, when grouped with [ATNA](https://profiles.ihe.net/ITI/TF/Volume1/ch-9.html) Secure Node or Secure Application Actor, shall be able to record fundamental AuditEvents for [BALP](https://profiles.ihe.net/ITI/BALP/index.html) [Create](https://profiles.ihe.net/ITI/BALP/1.1.2/StructureDefinition-IHE.BasicAudit.Create.html), when performing this transaction.
