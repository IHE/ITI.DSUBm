This section corresponds to transaction [ITI-111] Resource Publish of the IHE Technical Framework. The [ITI-111] Resource Publish is used by the Resource Notification Publisher and Resource Notification Broker Actors. This transaction is used to communicate a publication even. 

### 3.111.1 Scope

The [ITI-111] Resource Publish transaction delivers information from the Resource Notification Publisher to the Resource Notification Broker about an event about documents that may trigger a notification. 

### 3.111.2 Actors Roles

**Table: Actor Roles**

|Actor | Role |
|-------------------+--------------------------|
| [Resource Notification Publisher](volume-1.html#publisher)    | Publishes information to the Resource Notification Broker when applicable events occur for which a subscription may exist |
| [Resource Notification Broker](volume-1.html#broker) | Receives and processes information about events for which there may be a subscription |

### 3.111.3 Referenced Standards

**FHIR-R4B** [HL7 FHIR Release 4.3.0](https://www.hl7.org/FHIR/R4B)

### 3.111.4 Interactions

<figure>
{%include ITI-111-Publish-seq.svg%}
<figcaption><b>Figure 2:3.111: ITI-111 interactions</b></figcaption>
</figure>
<br clear="all">

#### 3.111.5 Resource Publish Request Message
This method uses an HTTP POST method on the target Resource Notification Broker endpoint to communicate a publication event that may have a subscription.

##### 3.111.5.1 Trigger Events

The Resource Notification Publisher needs to communicate the publication event to the Resource Notification Broker actor.

##### 3.111.5.2 Message Semantics

The Resource Notification Publisher shall initiate an HTTP request according to requirements defined in the HL7® FHIR® standard for “create” interaction ([https://hl7.org/fhir/R4B/http.html#create](https://hl7.org/fhir/R4B/http.html#create)). The message uses an HTTP POST method to submit a FHIR Bundle Resource ([Bundle](https://hl7.org/fhir/R4B/Bundle.html)). 

The `Bundle.Type` element shall be "transaction".  
The Bundle resource shall contain all the FHIR resources related to the publication event that has occured in the `Bundle.entry` elements.
The media type of the HTTP body shall be either `application/fhir+json` or `application/fhir+xml`.

###### 3.111.5.2.1 Grouping with MHDS Registry
If the Resource Notification Publisher is grouped with MHDS Registry, the resources included in the Bundle are a subset of the resources contained in the MHD Provide Document Bundle [ITI-65](https://profiles.ihe.net/ITI/MHD/ITI-65.html#2-3-65-provide-document-bundle-iti-65) transaction received by the MHSD Registry.

The Bundle shall include: one `SubmissionSet type List Resource`;  one or more `DocumentReference Resources`; zero or more  `SubmissionSet type List Resource`; zero or more `Folder type List Resources`, as defined in the [MHD profile](https://profiles.ihe.net/ITI/MHD/index.html), according with the content of the MHD Provide Document Bundle [ITI-65](https://profiles.ihe.net/ITI/MHD/ITI-65.html#2-3-65-provide-document-bundle-iti-65) transaction received by the MHSD Registry. Each of these resource shall be transmitted in one Bundle.entry.resource element.

###### 3.111.5.2.1 Grouping with XDS Document Registry
If the Resource Notification Publisher is grouped with an XDS Docment Registry the following mapping should be used.  
Between the [Submission Set Metadata Attribute](https://profiles.ihe.net/ITI/TF/Volume3/ch-4.2.html#4.2.3.3) and the SubmissionSet Notice List Resource defined in the [MHD SubmissionSetComprehensive - Mappings](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Comprehensive.SubmissionSet-mappings.html#mappings-for-xds-and-mhd-mapping-xds)


Between the [DocumentEntry Attributes](https://profiles.ihe.net/ITI/TF/Volume3/ch-4.2.html#4.2.3.2) and the DocumentReference Notice Resource defined in the [MHD ComprehensiveDocumentReference - Mappings](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Comprehensive.DocumentReference-mappings.html#mappings-for-xds-and-mhd-mapping-xds)


Between the [Folder Metadata Attributes](https://profiles.ihe.net/ITI/TF/Volume3/ch-4.2.html#4.2.3.4) and the the Folder Notice Resource (type List) defined in the [MHD FolderComprehensive - Mappings](https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Comprehensive.Folder-mappings.html#mappings-for-xds-and-mhd-mapping-xds). 



##### 3.111.5.3 Expected Actions

The Resource Notification Broker shall accept both media types application/fhir+json and application/fhir+xml.
On receipt of the Bundle, the Resource Notification Broker shall validate the resources and respond with one of the HTTP codes defined in the response Message Semantics.
If the Resource Notification Broker validations failed, the Resource Notification Broker shall return an error, as documented in Resource Publish Response Message. 
If the validation of the Resource Publish Request Message is completed and if there are matching subscriptions, the Resource Notification Broker shall send the corresponding Resource Notify [ITI-112] transaction to the appropriate Resource Notification Recipient.

#### 3.111.6 Resource Publish Response Message

The Resource Notification Broker sends a Resource Publish Response Message to respond to a Resource Publish Request Message.

##### 3.111.6.1 Trigger Events

The Resource Notification Broker has received a Resource Publish Request Message.

##### 3.111.6.2 Message Semantics

If the validation of the request message has failed the Resource Notification Broker shall respond with `HTTP 400 Bad Request`. 
Otherwise the Resource Notification Broker shall respond with an `HTTP 201 created` as described by standard [FHIR](https://hl7.org/fhir/R4B/http.html#create)


##### 3.111.6.3 Expected Actions

The Resource Notification Publisher processes the results according to application-defined rules.

### CapabilityStatement Resource
The Server implementing this transaction shall provide a CapabilityStatement Resource as described in ITI TF-2x: Appendix Z.3 indicating the transaction has been implemented. 
* Requirements CapabilityStatement for [Client](CapabilityStatement-IHE.ToDo.client.html)
* Requirements CapabilityStatement for [Server](CapabilityStatement-IHE.ToDo.server.html)

### Security Considerations

See [DSUBm Security Considerations](volume-1.html#security-considerations)

#### Security Audit Considerations

''TODO: The security audit criteria ''

##### Client Audit 

''TODO: the specifics''

##### Server Audit 

''TODO: the specifics''
